<p>&lt;!doctype html&gt;</p>
<html><br><head><br><meta charset="utf-8"><br><title>行走的机器人</title><br>    <style><br>    body, html {<br>    position: absolute;<br>    margin: 0;<br>    padding: 0;<br>    width: 100%;<br>    height: 100%;<br>    overflow: hidden;<br>}<br><br>canvas {<br>    position: absolute;<br>    width: 100%;<br>    height: 100%;<br>    background:#000;<br>    cursor: pointer;<br>}<br>    </style><br></head><br><br><body><br>    <audio src="In-Grid - I'm Folle de Toi - In-Grid, Banks, C..mp3" autoplay></audio><br>     <canvas></canvas><br><!-- 
                  ,--.    ,--.
                 ((O ))--((O ))
               ,'_`--'____`--'_`.
              _:  ____________  :_
             | | ||::::::::::|| | |
             | | ||::::::::::|| | |
             | | ||::::::::::|| | |
             |_| |/__________\| |_|
               |________________|
            __..-'            `-..__
         .-| : .----------------. : |-.
       ,\ || | |\______________/| | || /.
      /`.\:| | ||  __  __  __  || | |;/,'\
     :`-._\;.| || '--''--''--' || |,:/_.-':
     |    :  | || .----------. || |  :    |
     |    |  | || '----SSt---' || |  |    |
     |    |  | ||   _   _   _  || |  |    |
     :,--.;  | ||  (_) (_) (_) || |  :,--.;
     (`-'|)  | ||______________|| |  (|`-')
      `--'   | |/______________\| |   `--'
             |____________________|
              `.________________,'
               (_______)(_______)
               (_______)(_______)
               (_______)(_______)
               (_______)(_______)
              |        ||        |
              '--------''--------'
--><br></body><br>    <script><br>    {<br>    class Robot {<br>        constructor(color, light, size, x, y, struct) {<br>            this.x = x;<br>            this.points = [];<br>            this.links = [];<br>            this.frame = 0;<br>            this.dir = 1;<br>            this.size = size;<br>            this.color = Math.round(color);<br>            this.light = light;<br>            // —- 创建点 —-<br>            for (const p of struct.points) {<br>                this.points.push(new Robot.Point(size <em> p.x + x, size </em> p.y + y, p.f));<br>            }<br>            // —- 创建链接 —-<br>            for (const link of struct.links) {<br>                const p0 = this.points[link.p0];<br>                const p1 = this.points[link.p1];<br>                const dx = p0.x - p1.x;<br>                const dy = p0.y - p1.y;<br>                this.links.push(<br>                    new Robot.Link(<br>                        this,<br>                        p0,<br>                        p1,<br>                        Math.sqrt(dx <em> dx + dy </em> dy),<br>                        link.size <em> size / 3,<br>                        link.lum,<br>                        link.force,<br>                        link.disk<br>                    )<br>                );<br>            }<br>        }<br>        update() {<br>            if (++this.frame % 20 === 0) this.dir = -this.dir;<br>            if (<br>                dancerDrag &amp;&amp;<br>                this === dancerDrag &amp;&amp;<br>                this.size &lt; 16 &amp;&amp;<br>                this.frame &gt; 600<br>            ) {<br>                dancerDrag = null;<br>                dancers.push(<br>                    new Robot(<br>                        this.color,<br>                        this.light </em> 1.25,<br>                        this.size <em> 2,<br>                        pointer.x,<br>                        pointer.y - 100 </em> this.size <em> 2,<br>                        struct<br>                    )<br>                );<br>                dancers.sort(function(d0, d1) {<br>                    return d0.size - d1.size;<br>                });<br>            }<br>            // —- 初始化 —-<br>            for (const link of this.links) {<br>                const p0 = link.p0;<br>                const p1 = link.p1;<br>                const dx = p0.x - p1.x;<br>                const dy = p0.y - p1.y;<br>                const dist = Math.sqrt(dx </em> dx + dy <em> dy);<br>                if (dist) {<br>                    const tw = p0.w + p1.w;<br>                    const r1 = p1.w / tw;<br>                    const r0 = p0.w / tw;<br>                    const dz = (link.distance - dist) </em> link.force;<br>                    const sx = dx / dist <em> dz;<br>                    const sy = dy / dist </em> dz;<br>                    p1.x -= sx <em> r0;<br>                    p1.y -= sy </em> r0;<br>                    p0.x += sx <em> r1;<br>                    p0.y += sy </em> r1;<br>                }<br>            }<br>            // —- 初始化点 —-<br>            for (const point of this.points) {<br>                // —- 拖拽事件 —-<br>                if (this === dancerDrag &amp;&amp; point === pointDrag) {<br>                    point.x += (pointer.x - point.x) <em> 0.1;<br>                    point.y += (pointer.y - point.y) </em> 0.1;<br>                }<br>                // —- 跳舞事件 —-<br>                if (this !== dancerDrag) {<br>                    point.fn &amp;&amp; point.fn(16 <em> Math.sqrt(this.size), this.dir);<br>                }<br>                // —- 集合—-<br>                point.vx = point.x - point.px;<br>                point.vy = point.y - point.py;<br>                point.px = point.x;<br>                point.py = point.y;<br>                point.vx </em>= 0.995;<br>                point.vy <em>= 0.995;<br>                point.x += point.vx;<br>                point.y += point.vy + 0.01;<br>            }<br>            // —- 地面 —-<br>            for (const link of this.links) {<br>                const p1 = link.p1;<br>                if (p1.y &gt; canvas.height </em> ground - link.size <em> 0.5) {<br>                    p1.y = canvas.height </em> ground - link.size <em> 0.5;<br>                    p1.x -= p1.vx;<br>                    p1.vx = 0;<br>                    p1.vy = 0;<br>                }<br>            }<br>            // —- 自动居中 —-<br>            this.points[3].x += (this.x - this.points[3].x) </em> 0.001;<br>        }<br>        draw() {<br>            for (const link of this.links) {<br>                if (link.size) {<br>                    const dx = link.p1.x - link.p0.x;<br>                    const dy = link.p1.y - link.p0.y;<br>                    const a = Math.atan2(dy, dx);<br>                    const d = Math.sqrt(dx <em> dx + dy </em> dy);<br>                    // —- 阴影 —-<br>                    ctx.save();<br>                    ctx.translate(link.p0.x + link.size <em> 0.25, link.p0.y + link.size </em> 0.25);<br>                    ctx.rotate(a);<br>                    ctx.drawImage(<br>                        link.shadow,<br>                        -link.size <em> 0.5,<br>                        -link.size </em> 0.5,<br>                        d + link.size,<br>                        link.size<br>                    );<br>                    ctx.restore();<br>                    // —- 滑动 —-<br>                    ctx.save();<br>                    ctx.translate(link.p0.x, link.p0.y);<br>                    ctx.rotate(a);<br>                    ctx.drawImage(<br>                        link.image,<br>                        -link.size <em> 0.5,<br>                        -link.size </em> 0.5,<br>                        d + link.size,<br>                        link.size<br>                    );<br>                    ctx.restore();<br>                }<br>            }<br>        }<br>    }<br>    Robot.Link = class Link {<br>        constructor(parent, p0, p1, dist, size, light, force, disk) {<br>            // —- 缓存 —-<br>            function stroke(color, axis) {<br>                const image = document.createElement(“canvas”);<br>                image.width = dist + size;<br>                image.height = size;<br>                const ict = image.getContext(“2d”);<br>                ict.beginPath();<br>                ict.lineCap = “round”;<br>                ict.lineWidth = size;<br>                ict.strokeStyle = color;<br>                if (disk) {<br>                    ict.arc(size <em> 0.5 + dist, size </em> 0.5, size <em> 0.5, 0, 2 </em> Math.PI);<br>                    ict.fillStyle = color;<br>                    ict.fill();<br>                } else {<br>                    ict.moveTo(size <em> 0.5, size </em> 0.5);<br>                    ict.lineTo(size <em> 0.5 + dist, size </em> 0.5);<br>                    ict.stroke();<br>                }<br>                if (axis) {<br>                    const s = size / 10;<br>                    ict.fillStyle = “#000”;<br>                    ict.fillRect(size <em> 0.5 - s, size </em> 0.5 - s, s <em> 2, s </em> 2);<br>                    ict.fillRect(size <em> 0.5 - s + dist, size </em> 0.5 - s, s <em> 2, s </em> 2);<br>                }<br>                return image;<br>            }<br>            this.p0 = p0;<br>            this.p1 = p1;<br>            this.distance = dist;<br>            this.size = size;<br>            this.light = light || 1.0;<br>            this.force = force || 0.5;<br>            this.image = stroke(<br>                “hsl(“ + parent.color + “ ,30%, “ + parent.light <em> this.light + “%)”,<br>                true<br>            );<br>            this.shadow = stroke(“rgba(0,0,0,0.5)”);<br>        }<br>    };<br>    Robot.Point = class Point {<br>        constructor(x, y, fn, w) {<br>            this.x = x;<br>            this.y = y;<br>            this.w = w || 0.5;<br>            this.fn = fn || null;<br>            this.px = x;<br>            this.py = y;<br>            this.vx = 0.0;<br>            this.vy = 0.0;<br>        }<br>    };<br>    // —- 设置 canvas —-<br>    const canvas = {<br>        init() {<br>            this.elem = document.querySelector(“canvas”);<br>            this.resize();<br>            window.addEventListener(“resize”, () =&gt; this.resize(), false);<br>            return this.elem.getContext(“2d”);<br>        },<br>        resize() {<br>            this.width = this.elem.width = this.elem.offsetWidth;<br>            this.height = this.elem.height = this.elem.offsetHeight;<br>            ground = this.height &gt; 500 ? 0.85 : 1.0;<br>            for (let i = 0; i &lt; dancers.length; i++) {<br>                dancers[i].x = (i + 2) </em> canvas.width / 9;<br>            }<br>        }<br>    };<br>    // —- 设置点 —-<br>    const pointer = {<br>        init(canvas) {<br>            this.x = 0;<br>            this.y = 0;<br>            window.addEventListener(“mousemove”, e =&gt; this.move(e), false);<br>            canvas.elem.addEventListener(“touchmove”, e =&gt; this.move(e), false);<br>            window.addEventListener(“mousedown”, e =&gt; this.down(e), false);<br>            window.addEventListener(“touchstart”, e =&gt; this.down(e), false);<br>            window.addEventListener(“mouseup”, e =&gt; this.up(e), false);<br>            window.addEventListener(“touchend”, e =&gt; this.up(e), false);<br>        },<br>        down(e) {<br>            this.move(e);<br>            for (const dancer of dancers) {<br>                for (const point of dancer.points) {<br>                    const dx = pointer.x - point.x;<br>                    const dy = pointer.y - point.y;<br>                    const d = Math.sqrt(dx <em> dx + dy </em> dy);<br>                    if (d &lt; 60) {<br>                        dancerDrag = dancer;<br>                        pointDrag = point;<br>                        dancer.frame = 0;<br>                    }<br>                }<br>            }<br>        },<br>        up(e) {<br>            dancerDrag = null;<br>        },<br>        move(e) {<br>            let touchMode = e.targetTouches,<br>                pointer;<br>            if (touchMode) {<br>                e.preventDefault();<br>                pointer = touchMode[0];<br>            } else pointer = e;<br>            this.x = pointer.clientX;<br>            this.y = pointer.clientY;<br>        }<br>    };<br>    // —- 初始化 —-<br>    const dancers = [];<br>    let ground = 1.0;<br>    const ctx = canvas.init();<br>    pointer.init(canvas);<br>    let dancerDrag = null;<br>    let pointDrag = null;<br>    // —- 主要循环 —-<br>    const run = () =&gt; {<br>        requestAnimationFrame(run);<br>        ctx.clearRect(0, 0, canvas.width, canvas.height);<br>        ctx.fillStyle = “#222”;<br>        ctx.fillRect(0, 0, canvas.width, canvas.height <em> 0.15);<br>        ctx.fillRect(0, canvas.height </em> 0.85, canvas.width, canvas.height <em> 0.15);<br>        for (const dancer of dancers) {<br>            dancer.update();<br>            dancer.draw();<br>        }<br>    };<br>    // —- 机器人构造 —-<br>    const struct = {<br>        points: [<br>            {<br>                x: 0,<br>                y: -4,<br>                f(s, d) {<br>                    this.y -= 0.01 </em> s;<br>                }<br>            },<br>            {<br>                x: 0,<br>                y: -16,<br>                f(s, d) {<br>                    this.y -= 0.02 <em> s </em> d;<br>                }<br>            },<br>            {<br>                x: 0,<br>                y: 12,<br>                f(s, d) {<br>                    this.y += 0.02 <em> s </em> d;<br>                }<br>            },<br>            { x: -12, y: 0 },<br>            { x: 12, y: 0 },<br>            {<br>                x: -3,<br>                y: 34,<br>                f(s, d) {<br>                    if (d &gt; 0) {<br>                        this.x += 0.01 <em> s;<br>                        this.y -= 0.015 </em> s;<br>                    } else {<br>                        this.y += 0.02 <em> s;<br>                    }<br>                }<br>            },<br>            {<br>                x: 3,<br>                y: 34,<br>                f(s, d) {<br>                    if (d &gt; 0) {<br>                        this.y += 0.02 </em> s;<br>                    } else {<br>                        this.x -= 0.01 <em> s;<br>                        this.y -= 0.015 </em> s;<br>                    }<br>                }<br>            },<br>            {<br>                x: -28,<br>                y: 0,<br>                f(s, d) {<br>                    this.x += this.vx <em> 0.035;<br>                    this.y -= 0.001 </em> s;<br>                }<br>            },<br>            {<br>                x: 28,<br>                y: 0,<br>                f(s, d) {<br>                    this.x += this.vx <em> 0.035;<br>                    this.y -= 0.001 </em> s;<br>                }<br>            },<br>            {<br>                x: -3,<br>                y: 64,<br>                f(s, d) {<br>                    this.y += 0.015 <em> s;<br>                    if (d &gt; 0) {<br>                        this.y -= 0.01 </em> s;<br>                    } else {<br>                        this.y += 0.05 <em> s;<br>                    }<br>                }<br>            },<br>            {<br>                x: 3,<br>                y: 64,<br>                f(s, d) {<br>                    this.y += 0.015 </em> s;<br>                    if (d &gt; 0) {<br>                        this.y += 0.05 <em> s;<br>                    } else {<br>                        this.y -= 0.01 </em> s;<br>                    }<br>                }<br>            }<br>        ],<br>        links: [<br>            { p0: 3, p1: 7, size: 12, lum: 0.5 },<br>            { p0: 1, p1: 3, size: 24, lum: 0.5 },<br>            { p0: 1, p1: 0, size: 60, lum: 0.5, disk: 1 },<br>            { p0: 5, p1: 9, size: 16, lum: 0.5 },<br>            { p0: 2, p1: 5, size: 32, lum: 0.5 },<br>            { p0: 1, p1: 2, size: 50, lum: 1 },<br>            { p0: 6, p1: 10, size: 16, lum: 1.5 },<br>            { p0: 2, p1: 6, size: 32, lum: 1.5 },<br>            { p0: 4, p1: 8, size: 12, lum: 1.5 },<br>            { p0: 1, p1: 4, size: 24, lum: 1.5 }<br>        ]<br>    };<br><br>    for (let i = 0; i &lt; 6; i++) {<br>        dancers.push(<br>            new Robot(<br>                i <em> 360 / 7,<br>                80,<br>                (window.location.href.indexOf(“fullcpgrid”) &gt; -1) ? 3 : 4,<br>                (i + 2) </em> canvas.width / 9,<br>                canvas.height * ground - 300,<br>                struct<br>            )<br>        );<br>    }<br>    run();<br>}<br><br>    </script><br></html>
